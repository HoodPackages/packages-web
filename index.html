<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="/src/style.css" rel="stylesheet">
</head>

<body>
  <div id="root"></div>
  <div class="gtranslate_wrapper"></div>
  <script>
    (function () {
      const supportedLanguages = ["uk", "en", "de", "fr", "it"];

      let browserLang = navigator.language || navigator.userLanguage;
      browserLang = browserLang.slice(0, 2).toLowerCase();

      if (!supportedLanguages.includes(browserLang)) {
        browserLang = "en";
      }

      window.gtranslateSettings = {
        default_language: "uk",
        detect_browser_language: false,
        languages: supportedLanguages,
        wrapper_selector: ".gtranslate_wrapper"
      };
    })();
  </script>
  <script src="https://cdn.gtranslate.net/widgets/latest/float.js" defer></script>

  <script>
    (function () {
      const STORAGE_KEY = "app_language";
      const DEFAULT_LANG = "uk";

      function getLangFromCookie() {
        const match = document.cookie.match(/googtrans=\/[^\/]+\/([^;]+)/);
        return match ? match[1] : null;
      }

      setInterval(() => {
        const cookieLang = getLangFromCookie();
        const langToStore = cookieLang || DEFAULT_LANG;

        if (localStorage.getItem(STORAGE_KEY) !== langToStore) {
          localStorage.setItem(STORAGE_KEY, langToStore);
        }
      }, 500);

      window.getAppLanguage = function () {
        return localStorage.getItem(STORAGE_KEY) || DEFAULT_LANG;
      };
    })();
  </script>


  <script>
    (function () {
      const HOME_TITLE = 'Головна';
      let observer = null;

      function isHomePage() {
        return (
          location.pathname === '/' ||
          location.pathname === '/index.html'
        );
      }

      function enableTitleLock() {
        document.title = HOME_TITLE;

        const titleEl = document.querySelector('title');
        if (!titleEl) return;

        observer = new MutationObserver(() => {
          if (document.title !== HOME_TITLE) {
            document.title = HOME_TITLE;
          }
        });

        observer.observe(titleEl, {
          childList: true,
          subtree: true,
          characterData: true,
        });
      }

      function disableTitleLock() {
        if (observer) {
          observer.disconnect();
          observer = null;
        }
      }

      function handleRouteChange() {
        if (isHomePage()) {
          enableTitleLock();
        } else {
          disableTitleLock();
        }
      }

      handleRouteChange();

      const pushState = history.pushState;
      const replaceState = history.replaceState;

      history.pushState = function () {
        pushState.apply(this, arguments);
        handleRouteChange();
      };

      history.replaceState = function () {
        replaceState.apply(this, arguments);
        handleRouteChange();
      };

      window.addEventListener('popstate', handleRouteChange);
    })();
  </script>

  <script type="module" src="/src/main.jsx"></script>
</body>

</html>